(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1297:function(t,e,n){var content=n(1353);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(7).default)("699f6ea8",content,!0,{sourceMap:!1})},1352:function(t,e,n){"use strict";var r=n(1297);n.n(r).a},1353:function(t,e,n){(e=n(6)(!1)).push([t.i,".test-type-select[data-v-74c408b3]{min-width:400px}",""]),t.exports=e},1408:function(t,e,n){"use strict";n.r(e);n(8);var r=n(3),l=n(88),o=(n(55),{name:"SingleTest",props:["loading"],data:function(){return{type:"one-answer",tests:[],visibleAdd:!1,current:"",selectedRow:[],fields:[{key:"answer",label:"Ответ"},"Действия"],currentId:1}},computed:{answersTable:function(){var t=[];return this.tests.forEach((function(e){t.push({answer:e.answer})})),t},answer:function(){var t=this;return 1===this.selectedRow.length&&this.tests.find((function(e){return e.answer===t.selectedRow[0].answer})).id}},mounted:function(){var t=this;l.a.$on("clear-create-test-teacher",(function(e){t.tests=[],t.selectedRow=[],t.current="",t.visibleAdd=!1,t.currentId=1}))},methods:{rowClass:function(t,e){if(t&&"row"===e)return 1===this.selectedRow.length&&t.answer===this.selectedRow[0].answer?"table-success-row":void 0},addAnswer:function(){var t=this;return this.current&&0!==this.current.length?this.tests.some((function(e){return e.answer===t.current}))?this.$notify.error({title:"Ошибка",message:"Дублирующийся вариант ответа",duration:1e3}):(this.tests.push({id:this.currentId,answer:this.current}),this.currentId++,void this.$notify.success({title:"Успех",message:"Тест добавлен",duration:1e3})):this.$notify.error({title:"Ошибка",message:"Варинт ответа не может быть пустым!",duration:1e3})},save:function(){this.$emit("save-test",{type:this.type,tests:this.tests,answer:this.answer})},deleteTest:function(t){this.selectedRow=this.selectedRow.filter((function(e){return e.answer!==t.answer})),this.tests=this.tests.filter((function(e){return e.answer!==t.answer}))},onRowSelect:function(t){if(this.selectedRow.some((function(e){return e.answer===t.answer})))return this.selectedRow=[];this.selectedRow.length>0&&(this.selectedRow=[]),this.selectedRow.push(t)}}}),c=n(2),d=Object(c.a)(o,(function(){var t=this,e=this,n=e.$createElement,r=e._self._c||n;return r("div",[r("el-button",{on:{click:function(e){return t.visibleAdd=!0}}},[e._v("\n    Добавить вариант ответа\n  ")]),e._v(" "),r("el-dialog",{attrs:{title:"Добавление варианта ответа","before-close":function(e){return t.visibleAdd=!1},visible:e.visibleAdd,width:"30%",center:""}},[r("b-input-group",[r("b-form-input",{attrs:{placeholder:"Вариант ответа",trim:""},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addAnswer(t)}},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}})],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"success"},on:{click:e.addAnswer}},[e._v("Добавить вариант ответа")]),e._v(" "),r("el-button",{on:{click:function(e){return t.visibleAdd=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),r("b-overlay",{staticClass:"d-inline-block",attrs:{show:e.loading,opacity:"0.6","spinner-small":"","spinner-variant":"primary"}},[r("b-button",{attrs:{id:"save-single-test-button",variant:"outline-success",disabled:e.loading||!(e.answer&&e.tests.length>1)},on:{click:e.save}},[e._v("\n      Сохранить тест\n    ")])],1),e._v(" "),e.tests.length>0&&0===e.selectedRow.length?r("b-form-text",[e._v("\n    Выберите один правильный ответ\n  ")]):e._e(),e._v(" "),1===e.tests.length&&1===e.selectedRow.length?r("b-form-text",[e._v("\n    Минимальное количество вариантов ответа - 2\n  ")]):e._e(),e._v("\n  >\n  "),e.tests.length>0?r("div",[r("b-table",{ref:"selectableTable",attrs:{selectable:"","select-mode":"single",items:e.answersTable,fields:e.fields,"tbody-tr-class":e.rowClass,responsive:"sm"},on:{"row-clicked":e.onRowSelect},scopedSlots:e._u([{key:"cell(Действия)",fn:function(t){var n=t.item;return[r("b-button",{on:{click:function(t){return e.deleteTest(n)}}},[e._v("\n          Удалить\n        ")])]}}],null,!1,1580578304)})],1):e._e()],1)}),[],!1,null,"37ae7f0f",null).exports,v={name:"MiltyAnswer",props:["loading"],data:function(){return{type:"milty-answer",tests:[],selectedRows:[],visibleAdd:!1,current:null,fields:[{key:"answer",label:"Ответ"},"Действия"],currentId:1}},computed:{answersTable:function(){var t=[];return this.tests.forEach((function(e){t.push({answer:e.answer})})),t},answers:function(){var t=this,e=[];return this.selectedRows.forEach((function(n){e.push(t.tests.find((function(t){return t.answer===n.answer})).id)})),e}},mounted:function(){var t=this;l.a.$on("clear-create-test-teacher",(function(e){t.tests=[],t.selectedRows=[],t.currentId=1,t.current=null,t.visibleAdd=!1}))},methods:{addAnswer:function(){var t=this;return this.current&&0!==this.current.length?this.tests.some((function(e){return e.answer===t.current}))?this.$notify.error({title:"Ошибка",message:"Дублирующийся вариант ответа",duration:1e3}):(this.tests.push({id:this.currentId,answer:this.current}),this.currentId++,void this.$notify.success({title:"Успех",message:"Тест добавлен",duration:1e3})):this.$notify.error({title:"Ошибка",message:"Варинт ответа не может быть пустым!",duration:1e3})},rowClass:function(t,e){if(t&&"row"===e)return this.selectedRows.some((function(e){return e.answer===t.answer}))?"table-success-row":void 0},save:function(){this.$emit("save-test",{type:this.type,tests:this.tests,answer:this.answers})},deleteTest:function(t){this.tests=this.tests.filter((function(e){return e.answer!==t.answer})),this.selectedRows=this.selectedRows.filter((function(e){return e.answer!==t.answer}))},onRowSelect:function(t){this.selectedRows.some((function(e){return e.answer===t.answer}))?this.selectedRows=this.selectedRows.filter((function(e){return e.answer!==t.answer})):this.selectedRows.push(t)}}},h=Object(c.a)(v,(function(){var t=this,e=this,n=e.$createElement,r=e._self._c||n;return r("div",[r("el-button",{on:{click:function(e){return t.visibleAdd=!0}}},[e._v("\n    Добавить вариант ответа\n  ")]),e._v(" "),r("b-overlay",{staticClass:"d-inline-block",attrs:{show:e.loading,opacity:"0.6","spinner-small":"","spinner-variant":"primary"}},[r("b-button",{attrs:{variant:"outline-success",disabled:e.loading||!(e.answers.length>0&&e.tests.length>1)},on:{click:e.save}},[e._v("\n      Сохранить тест\n    ")]),e._v("\n    >\n  ")],1),e._v(" "),e.tests.length>0&&0===e.selectedRows.length?r("b-form-text",[e._v("\n    Выберте правильный(е) ответ(ы)\n  ")]):e._e(),e._v(" "),1===e.tests.length&&1===e.selectedRows.length?r("b-form-text",[e._v("\n    Минимальное количество вариантов ответа - 2\n  ")]):e._e(),e._v("\n  >\n  "),r("el-dialog",{attrs:{title:"Добавление варианта ответа","before-close":function(e){return t.visibleAdd=!1},visible:e.visibleAdd,width:"30%",center:""}},[r("b-input-group",[r("b-form-input",{attrs:{placeholder:"Вариант ответа",trim:""},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addAnswer(t)}},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}})],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"success"},on:{click:e.addAnswer}},[e._v("Добавить вариант ответа")]),e._v(" "),r("el-button",{on:{click:function(e){return t.visibleAdd=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),e.tests.length>0?r("div",[r("b-table",{ref:"selectableTable",attrs:{selectable:"","select-mode":"multi",items:e.answersTable,fields:e.fields,"tbody-tr-class":e.rowClass,responsive:"sm"},on:{"row-clicked":e.onRowSelect},scopedSlots:e._u([{key:"cell(Действия)",fn:function(t){var n=t.item;return[r("b-button",{on:{click:function(t){return e.deleteTest(n)}}},[e._v("\n          Удалить\n        ")])]}}],null,!1,1580578304)})],1):e._e()],1)}),[],!1,null,"0b3f3079",null).exports,f={name:"OpenAnswer",props:["loading"],data:function(){return{answer:"",validate:{answer:0}}},computed:{validationAnswerState:function(){return 0===this.validate.answer?null:1===this.validate.answer},invalidFeedbackAnswer:function(){return 2===this.validate.answer?"Введите ответ":""}},mounted:function(){var t=this;l.a.$on("clear-create-test-teacher",(function(e){t.answer="",t.validate.answer=0}))},methods:{save:function(){if(this.validateAnswer(),!this.validationAnswerState)return this.$notify.error({title:"Ошибка",message:"Проверьте введенные данные",duration:1e3});this.$emit("save-test",{type:"open-answer",tests:null,answer:this.answer})},validateAnswer:function(){0===this.answer.length?this.validate.answer=2:this.validate.answer=1}}},w={name:"Create",layout:"teacher",middleware:"authTeacher",components:{OpenAnswer:Object(c.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-input-group",{staticClass:"mb-2"},[n("b-form-input",{attrs:{placeholder:"Ответ",state:t.validationAnswerState,trim:""},on:{blur:t.validateAnswer,change:t.validateAnswer},nativeOn:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.save(e)}},model:{value:t.answer,callback:function(e){t.answer=e},expression:"answer"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{state:t.validationAnswerState}},[t._v("\n      "+t._s(t.invalidFeedbackAnswer)+"!\n    ")])],1),t._v(" "),n("b-overlay",{staticClass:"d-inline-block",attrs:{show:t.loading,opacity:"0.6","spinner-small":"","spinner-variant":"primary"}},[n("b-button",{attrs:{variant:"outline-success",disabled:t.loading||!t.validationAnswerState},on:{click:t.save}},[t._v("\n      Сохранить тест\n    ")])],1)],1)}),[],!1,null,"77eca64b",null).exports,SingleTest:d,MiltyTest:h},data:function(){return{title:"",task:"",type:"one-answer",options:[{value:"one-answer",label:"Тест с одним правильным ответом"},{value:"milty-answer",label:"Тест с несколькими правильными ответами"},{value:"open-answer",label:"Задание с открытым ответом"}],validate:{title:0,task:0},loading:!1,toTaskId:null}},computed:{validationTitleState:function(){return 0===this.validate.title?null:1===this.validate.title},validationTaskState:function(){return 0===this.validate.task?null:1===this.validate.task},invalidFeedbackTitle:function(){return 2===this.validate.title?"Введите название теста":3===this.validate.title?"Название теста слишком короткое":4===this.validate.title?"Название теста слишком длинное":void 0},invalidFeedbackTask:function(){return 2===this.validate.task?"Задание не может быть пустым":3===this.validate.task?"Задание слишком короткое":4===this.validate.task?"Задание слишком длинное":void 0}},methods:{saveTest:function(data){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,l,code,o,title;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"one-answer"===t.type?n=1:"milty-answer"===t.type?n=2:"open-answer"===t.type&&(n=3),e.next=3,t.validateTask();case 3:return e.next=5,t.validateTitle();case 5:if(!t.validationTitleState||!t.validationTaskState){e.next=33;break}return t.loading=!0,e.next=9,t.$store.dispatch("teacher/test/createTest",{title:t.title,task:t.task,type:n,answerChoice:data.tests,rightAnswer:data.answer});case 9:if(r=e.sent,l=r._id,!(code=r.code)){e.next=29;break}title="Ошибка",e.t0=code,e.next=1===e.t0?16:2===e.t0?18:3===e.t0?20:4===e.t0?22:24;break;case 16:return o="Ошибка заголовка или задания",e.abrupt("break",26);case 18:return o="Тип задания не указан",e.abrupt("break",26);case 20:return o="Ошибка в вводе вариантов ответа",e.abrupt("break",26);case 22:return o="Ошибка в вводе правильного ответа",e.abrupt("break",26);case 24:return o="Неизвестная ошибка",e.abrupt("break",26);case 26:t.$notify.error({title:title,message:o}),e.next=30;break;case 29:l&&(t.toTaskId=l,t.clearTest(),t.$notify.success({message:"Успех",title:"Тест успешно создан"}));case 30:t.loading=!1,e.next=34;break;case 33:t.$notify.error({message:"Проверьте введенные данные",title:"Ошибка при создании"});case 34:case"end":return e.stop()}}),e)})))()},validateTitle:function(){0===this.title.length?this.validate.title=2:this.title.length<3?this.validate.title=3:this.title.length>70?this.validate.title=4:this.validate.title=1},validateTask:function(){0===this.task.length?this.validate.task=2:this.task.length<10?this.validate.task=3:this.task.length>700?this.validate.task=4:this.validate.task=1},clearTest:function(){l.a.$emit("clear-create-test-teacher"),this.title="",this.task="",this.validate.title=0,this.validate.task=0},viewTest:function(){this.$router.push("/teacherinterface/materials/tests/".concat(this.toTaskId))}}},k=(n(1352),Object(c.a)(w,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-select",{staticClass:"test-type-select",model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.options,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),t._v(" "),n("el-card",[n("b-input-group",{staticClass:"mb-2"},[n("b-input-group-prepend",{attrs:{"is-text":""}},[n("i",{staticClass:"el-icon-tickets"})]),t._v(" "),n("b-form-input",{attrs:{type:"text",state:t.validationTitleState,placeholder:"Название теста",trim:""},on:{blur:t.validateTitle},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{state:t.validationTitleState}},[t._v("\n        "+t._s(t.invalidFeedbackTitle)+"!\n      ")])],1),t._v(" "),t.validationTitleState||null===t.validationTitleState?n("b-form-text",[t._v("\n      Заголовок теста должен быть от 3 до 70 символов\n    ")]):t._e(),t._v(" "),n("b-input-group",{staticClass:"mb-2"},[n("b-input-group-prepend",{attrs:{"is-text":""}},[n("i",{staticClass:"el-icon-edit"})]),t._v(" "),n("b-form-input",{attrs:{type:"text",state:t.validationTaskState,placeholder:"Задание",trim:""},on:{blur:t.validateTask},model:{value:t.task,callback:function(e){t.task=e},expression:"task"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{state:t.validationTaskState}},[t._v("\n        "+t._s(t.invalidFeedbackTask)+"!\n      ")])],1),t._v(" "),t.validationTaskState||null===t.validationTaskState?n("b-form-text",[t._v("\n      Задание должно быть от 10 до 700 знаков (скоро будут возможность\n      добавления картинок)\n    ")]):t._e(),t._v(" "),t.toTaskId?n("b-button",{attrs:{variant:"info"},on:{click:t.viewTest}},[t._v("\n      К просмотру задания\n    ")]):t._e(),t._v(" "),"one-answer"===t.type?n("SingleTest",{attrs:{loading:t.loading},on:{"save-test":t.saveTest}}):"milty-answer"===t.type?n("MiltyTest",{attrs:{loading:t.loading},on:{"save-test":t.saveTest}}):"open-answer"===t.type?n("OpenAnswer",{attrs:{loading:t.loading},on:{"save-test":t.saveTest}}):t._e()],1)],1)}),[],!1,null,"74c408b3",null));e.default=k.exports}}]);